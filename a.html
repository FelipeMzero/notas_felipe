<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Acad√™mico BSI - UFOPA</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Recharts (Gr√°ficos) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .input-grade { 
            background: #1e293b; border: 1px solid #334155; color: white; 
            width: 60px; text-align: center; border-radius: 4px; padding: 4px;
        }
        .input-grade:focus { outline: 2px solid #3b82f6; border-color: transparent; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer } = Recharts;

        // --- DADOS INICIAIS (CURR√çCULO) ---
        const initialCurriculum = [
            // 1¬∫ Semestre
            { code: "BSI0001", name: "INTRODU√á√ÉO A SISTEMAS DE INFORMA√á√ÉO", sem: 1 },
            { code: "BSI0002", name: "MATEM√ÅTICA DISCRETA E L√ìGICA MATEM√ÅTICA", sem: 1 },
            { code: "BSI0003", name: "ORGANIZA√á√ÉO DE COMPUTADORES", sem: 1 },
            { code: "BSI0005", name: "METODOLOGIA CIENT√çFICA", sem: 1 },
            { code: "CORI0082", name: "PROGRAMA√á√ÉO", sem: 1 },
            // 2¬∫ Semestre
            { code: "BSI0006", name: "PROGRAMA√á√ÉO ORIENTADA A OBJETOS", sem: 2 },
            { code: "BSI0007", name: "ESTRUTURA DE DADOS I", sem: 2 },
            { code: "BSI0008", name: "ARQUITETURA DE COMPUTADORES", sem: 2 },
            { code: "BSI0009", name: "√ÅLGEBRA LINEAR", sem: 2 },
            { code: "BSI0010", name: "C√ÅLCULO I", sem: 2 },
            // 3¬∫ Semestre
            { code: "CORI0040", name: "GEOMETRIA ANAL√çTICA", sem: 3 },
            { code: "CORI0041", name: "LABORAT√ìRIO DE PROGRAMA√á√ÉO", sem: 3 },
            { code: "CORI0042", name: "ESTRUTURA DE DADOS II", sem: 3 },
            { code: "CORI0043", name: "SISTEMAS OPERACIONAIS", sem: 3 },
            { code: "CORI0048", name: "C√ÅLCULO II", sem: 3 },
            // 4¬∫ Semestre
            { code: "CORI0049", name: "LINGUAGENS FORMAIS E AUT√îMATOS", sem: 4 },
            { code: "CORI0050", name: "BANCO DE DADOS", sem: 4 },
            { code: "CORI0051", name: "ENGENHARIA DE REQUISITOS", sem: 4 },
            { code: "CORI0052", name: "SISTEMAS DE INOVA√á√ÉO E EMPREENDEDORISMO", sem: 4 },
            { code: "CORI0053", name: "PROBABILIDADE E ESTAT√çSTICA", sem: 4 },
            // 5¬∫ Semestre
            { code: "CORI0054", name: "PROGRAMA√á√ÉO PARA WEB", sem: 5 },
            { code: "CORI0055", name: "AN√ÅLISE E PROJETO DE SOFTWARE", sem: 5 },
            { code: "CORI0056", name: "REDES DE COMPUTADORES", sem: 5 },
            { code: "CORI0057", name: "PROCESSAMENTO DE IMAGEM", sem: 5 },
            { code: "CORI0058", name: "ADMINISTRA√á√ÉO DA INFORM√ÅTICA", sem: 5 },
            // 6¬∫ Semestre
            { code: "CORI0059", name: "DESENVOLVIMENTO PARA DISPOSITIVOS M√ìVEIS", sem: 6 },
            { code: "CORI0060", name: "INTERA√á√ÉO HUMANO-COMPUTADOR", sem: 6 },
            { code: "CORI0061", name: "COMPUTA√á√ÉO GR√ÅFICA", sem: 6 },
            { code: "CORI0062", name: "GER√äNCIA DE SERVI√áOS DE TI", sem: 6 },
            { code: "CORI0063", name: "GER√äNCIA DE REDES", sem: 6 },
            // 7¬∫ Semestre
            { code: "CORI0064", name: "PSICOLOGIA APLICADA √Ä INFORM√ÅTICA", sem: 7 },
            { code: "CORI0066", name: "TESTE E QUALIDADE DE SOFTWARE", sem: 7 },
            { code: "CORI0067", "name": "AVALIA√á√ÉO DE DESEMPENHO", sem: 7 },
            { code: "CORI0068", name: "T√ìPICOS INTEGRADORES", sem: 7 },
            { code: "CORI0069", name: "PROJETOS DE DESENVOLVIMENTO APLICADO", sem: 7 },
            { code: "CORI0075", name: "TCC I", sem: 7 },
            // 8¬∫ Semestre
            { code: "CORI0070", name: "EST√ÅGIO SUPERVISIONADO", sem: 8 },
            { code: "CORI0072", name: "GER√äNCIA DE PROJETOS", sem: 8 },
            { code: "CORI0073", name: "SISTEMAS DISTRIBU√çDOS", sem: 8 },
            { code: "CORI0074", name: "INTRODU√á√ÉO √Ä GOVERNAN√áA DE TI", sem: 8 },
            { code: "CORI0078", name: "INTELIG√äNCIA ARTIFICIAL", sem: 8 },
            { code: "CORI0079", name: "TCC II", sem: 8 },
            { code: "CORI0080", name: "SEGURAN√áA DA INFORMA√á√ÉO", sem: 8 },
            // ENADE
            { code: "ENADE-I", name: "ENADE INGRESSANTE", sem: 9 },
            { code: "ENADE-C", name: "ENADE CONCLUINTE", sem: 9 },
        ];

        // --- DADOS INICIAIS (HIST√ìRICO DO USU√ÅRIO) ---
        const userHistory = {
            "BSI0007": [8.6, 9.5, 9.5], "BSI0001": [9.2, 8.5, 9.5], "BSI0005": [6.5, 7.0, 2.0],
            "BSI0003": [5.0, 10.0, 9.0], "CORI0082": [10.0, 4.0, 9.0], "CORI0043": [9.5, 8.0, 8.0],
            "BSI0008": [7.5, 9.8, 8.5], "BSI0010": [8.4, 6.8, 8.0], 
            "CORI0042": [2.0, 2.5, 9.0], "CORI0041": [10.0, 10.0, 10.0], "BSI0002": [8.0, 4.0, 7.0],
            "BSI0009": [0.0, 0.0, 0.0], // Reprovado
            "CORI0050": [8.0, 10.0, 10.0], "CORI0051": [6.1, 9.5, 8.5], "CORI0040": [6.7, 4.0, 4.0], // Reprovado
            "BSI0006": [0.0, 0.0, 0.0], // Reprovado
            "CORI0049": [8.0, 8.2, 0.0], // Em andamento
            "CORI0053": [9.7, 10.0, 9.8], "CORI0057": [8.0, 10.0, 10.0], "CORI0054": [10.0, 2.5, 10.0],
            "CORI0056": [6.0, 9.0, 10.0], "CORI0078": [10.0, 4.0, 10.0], "CORI0074": [9.5, 9.8, 9.2],
            "CORI0080": [8.0, 10.0, 10.0]
        };

        const COLORS = {
            APROVADO: '#10b981', // green-500
            REPROVADO: '#ef4444', // red-500
            CURSANDO: '#f59e0b', // amber-500
            PENDENTE: '#475569'  // slate-600
        };

        const App = () => {
            // Estado Principal
            const [disciplines, setDisciplines] = useState([]);
            const [lastInteraction, setLastInteraction] = useState(Date.now());

            // --- INICIALIZA√á√ÉO ---
            useEffect(() => {
                const savedData = localStorage.getItem('bsi_data');
                if (savedData) {
                    setDisciplines(JSON.parse(savedData));
                } else {
                    // Mesclar Curr√≠culo com Hist√≥rico
                    const merged = initialCurriculum.map(disc => {
                        const history = userHistory[disc.code] || [0, 0, 0]; // Default notes
                        return {
                            ...disc,
                            n1: history[0] || "",
                            n2: history[1] || "",
                            n3: history[2] || "",
                        };
                    });
                    setDisciplines(merged);
                }
            }, []);

            // --- AUTO REFRESH LOGIC (10 MINUTOS) ---
            useEffect(() => {
                const interval = setInterval(() => {
                    const now = Date.now();
                    // 10 minutos = 600000 ms
                    if (now - lastInteraction > 600000) {
                        window.location.reload();
                    }
                }, 30000); // Checa a cada 30 seg

                const updateInteraction = () => setLastInteraction(Date.now());
                
                window.addEventListener('mousemove', updateInteraction);
                window.addEventListener('keypress', updateInteraction);
                window.addEventListener('click', updateInteraction);

                return () => {
                    clearInterval(interval);
                    window.removeEventListener('mousemove', updateInteraction);
                    window.removeEventListener('keypress', updateInteraction);
                    window.removeEventListener('click', updateInteraction);
                }
            }, [lastInteraction]);

            // --- PERSIST√äNCIA ---
            useEffect(() => {
                if (disciplines.length > 0) {
                    localStorage.setItem('bsi_data', JSON.stringify(disciplines));
                }
            }, [disciplines]);

            // --- L√ìGICA DE C√ÅLCULO ---
            const calculateStats = (disc) => {
                const n1 = parseFloat(disc.n1) || 0;
                const n2 = parseFloat(disc.n2) || 0;
                const n3 = parseFloat(disc.n3) || 0;
                const avg = (n1 + n2 + n3) / 3;
                
                let status = "PENDENTE";
                if (n1 === 0 && n2 === 0 && n3 === 0) status = "PENDENTE";
                else if (avg >= 6.0) status = "APROVADO";
                else if (avg > 0 && avg < 6.0) {
                    status = "REPROVADO"; 
                }
                
                // Override manual para disciplinas que parecem estar em curso no prompt
                if (status === "REPROVADO" && (disc.n3 === "" || disc.n3 === 0) && avg > 0) {
                     status = "CURSANDO";
                }

                return { avg: avg.toFixed(1), status };
            };

            const processedData = useMemo(() => {
                return disciplines.map(d => {
                    const { avg, status } = calculateStats(d);
                    return { ...d, avg, status };
                });
            }, [disciplines]);

            // --- HANDLERS ---
            const handleGradeChange = (code, field, value) => {
                // Permitir apenas n√∫meros e ponto/v√≠rgula
                const cleanValue = value.replace(',', '.');
                if (cleanValue !== "" && isNaN(cleanValue)) return;
                
                setDisciplines(prev => prev.map(d => 
                    d.code === code ? { ...d, [field]: cleanValue } : d
                ));
            };

            const exportToCSV = () => {
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "Semestre;Codigo;Disciplina;Nota 1;Nota 2;Nota 3;Media;Status\n";
                
                processedData.forEach(row => {
                    csvContent += `${row.sem};${row.code};${row.name};${row.n1};${row.n2};${row.n3};${row.avg};${row.status}\n`;
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "historico_bsi.csv");
                document.body.appendChild(link);
                link.click();
            };

            // --- GR√ÅFICOS DADOS ---
            const statusCount = processedData.reduce((acc, curr) => {
                acc[curr.status] = (acc[curr.status] || 0) + 1;
                return acc;
            }, {});

            const pieData = [
                { name: 'Aprovado', value: statusCount['APROVADO'] || 0 },
                { name: 'Reprovado', value: statusCount['REPROVADO'] || 0 },
                { name: 'Cursando', value: statusCount['CURSANDO'] || 0 },
                { name: 'Pendente', value: statusCount['PENDENTE'] || 0 },
            ];

            const totalDisciplines = processedData.length;
            const progress = ((statusCount['APROVADO'] || 0) / totalDisciplines) * 100;

            // --- COMPONENTES UI ---
            const StatusBadge = ({ status }) => {
                const colors = {
                    "APROVADO": "bg-emerald-500/20 text-emerald-400 border-emerald-500/50",
                    "REPROVADO": "bg-red-500/20 text-red-400 border-red-500/50",
                    "CURSANDO": "bg-amber-500/20 text-amber-400 border-amber-500/50",
                    "PENDENTE": "bg-slate-700 text-slate-400 border-slate-600",
                };
                return (
                    <span className={`px-2 py-1 rounded text-xs font-bold border ${colors[status] || colors["PENDENTE"]}`}>
                        {status}
                    </span>
                );
            };

            const renderSemester = (semNum) => {
                const semesterDiscs = processedData.filter(d => d.sem === semNum);
                if (semesterDiscs.length === 0) return null;

                return (
                    <div key={semNum} className="mb-6 bg-slate-800 rounded-lg p-4 shadow-lg border border-slate-700">
                        <h3 className="text-xl font-bold text-blue-400 mb-4 flex items-center">
                            <span className="mr-2">üìñ</span> {semNum}¬∫ Semestre
                        </h3>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left text-sm text-slate-300">
                                <thead className="bg-slate-900/50 text-slate-400 uppercase">
                                    <tr>
                                        <th className="p-3">C√≥digo</th>
                                        <th className="p-3">Disciplina</th>
                                        <th className="p-3 text-center">N1</th>
                                        <th className="p-3 text-center">N2</th>
                                        <th className="p-3 text-center">N3</th>
                                        <th className="p-3 text-center">M√©dia</th>
                                        <th className="p-3 text-center">Status</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-700">
                                    {semesterDiscs.map(disc => (
                                        <tr key={disc.code} className="hover:bg-slate-700/30 transition">
                                            <td className="p-3 font-mono text-xs text-slate-500">{disc.code}</td>
                                            <td className="p-3 font-medium">{disc.name}</td>
                                            <td className="p-3 text-center">
                                                <input 
                                                    className="input-grade"
                                                    value={disc.n1} 
                                                    onChange={(e) => handleGradeChange(disc.code, 'n1', e.target.value)}
                                                />
                                            </td>
                                            <td className="p-3 text-center">
                                                <input 
                                                    className="input-grade"
                                                    value={disc.n2} 
                                                    onChange={(e) => handleGradeChange(disc.code, 'n2', e.target.value)}
                                                />
                                            </td>
                                            <td className="p-3 text-center">
                                                <input 
                                                    className="input-grade"
                                                    value={disc.n3} 
                                                    onChange={(e) => handleGradeChange(disc.code, 'n3', e.target.value)}
                                                />
                                            </td>
                                            <td className="p-3 text-center font-bold text-white">
                                                {disc.avg}
                                            </td>
                                            <td className="p-3 text-center">
                                                <StatusBadge status={disc.status} />
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <header className="bg-slate-900 border-b border-slate-700 p-6 sticky top-0 z-50 shadow-2xl">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>
                                <h1 className="text-2xl font-bold text-blue-500 flex items-center gap-2">
                                    üéì Controle Acad√™mico BSI
                                </h1>
                                <p className="text-slate-400 text-sm flex items-center gap-2">
                                    <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                    Edi√ß√£o em tempo real ativa
                                </p>
                            </div>
                            <div className="flex gap-3">
                                <button 
                                    onClick={() => window.location.reload()}
                                    className="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg flex items-center gap-2 transition"
                                >
                                    üîÑ Reset
                                </button>
                                <button 
                                    onClick={exportToCSV}
                                    className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition shadow-lg shadow-blue-500/20"
                                >
                                    üì• Planilha
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-6">
                        
                        {/* Estat√≠sticas Topo */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
                                <h4 className="text-slate-400 text-sm uppercase">Progresso Global</h4>
                                <div className="text-3xl font-bold text-white mt-1">{progress.toFixed(1)}%</div>
                                <div className="w-full bg-slate-700 h-2 rounded-full mt-2">
                                    <div className="bg-blue-500 h-2 rounded-full" style={{ width: `${progress}%` }}></div>
                                </div>
                            </div>
                            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
                                <h4 className="text-slate-400 text-sm uppercase">Aprovadas</h4>
                                <div className="text-3xl font-bold text-emerald-400 mt-1">{statusCount['APROVADO'] || 0}</div>
                            </div>
                            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
                                <h4 className="text-slate-400 text-sm uppercase">Reprova√ß√µes</h4>
                                <div className="text-3xl font-bold text-red-400 mt-1">{statusCount['REPROVADO'] || 0}</div>
                            </div>
                            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
                                <h4 className="text-slate-400 text-sm uppercase">Pendentes</h4>
                                <div className="text-3xl font-bold text-slate-400 mt-1">{statusCount['PENDENTE'] || 0}</div>
                            </div>
                        </div>

                        {/* √Årea de Gr√°ficos e Alertas */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                            {/* Gr√°fico Pizza */}
                            <div className="bg-slate-800 p-6 rounded-lg border border-slate-700 lg:col-span-1">
                                <h3 className="text-lg font-bold mb-4 text-slate-200">Distribui√ß√£o de Status</h3>
                                <div className="h-64">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie
                                                data={pieData}
                                                cx="50%"
                                                cy="50%"
                                                innerRadius={60}
                                                outerRadius={80}
                                                paddingAngle={5}
                                                dataKey="value"
                                            >
                                                {pieData.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={COLORS[entry.name.toUpperCase()]} />
                                                ))}
                                            </Pie>
                                            <Tooltip contentStyle={{backgroundColor: '#1e293b', border: 'none'}} itemStyle={{color: '#fff'}} />
                                            <Legend verticalAlign="bottom" height={36}/>
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            {/* Alertas Cr√≠ticos */}
                            <div className="bg-slate-800 p-6 rounded-lg border border-slate-700 lg:col-span-2">
                                <h3 className="text-lg font-bold mb-4 text-slate-200 flex items-center">
                                    ‚ö†Ô∏è Aten√ß√£o Necess√°ria
                                </h3>
                                <div className="space-y-3">
                                    {processedData.filter(d => d.status === "REPROVADO").map(disc => (
                                        <div key={disc.code} className="bg-red-500/10 border-l-4 border-red-500 p-3 rounded flex justify-between items-center">
                                            <div>
                                                <span className="font-bold text-red-400">{disc.code}</span>
                                                <span className="text-slate-300 ml-2">{disc.name}</span>
                                            </div>
                                            <span className="text-sm text-red-300">Reprovado (M√©dia: {disc.avg})</span>
                                        </div>
                                    ))}
                                    {processedData.filter(d => d.status === "CURSANDO").map(disc => (
                                        <div key={disc.code} className="bg-amber-500/10 border-l-4 border-amber-500 p-3 rounded flex justify-between items-center">
                                            <div>
                                                <span className="font-bold text-amber-400">{disc.code}</span>
                                                <span className="text-slate-300 ml-2">{disc.name}</span>
                                            </div>
                                            <span className="text-sm text-amber-300">Em Andamento</span>
                                        </div>
                                    ))}
                                    {statusCount['REPROVADO'] === 0 && (
                                        <div className="text-slate-400 italic">Nenhuma disciplina cr√≠tica no momento.</div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Listagem de Semestres */}
                        <div className="space-y-6">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(sem => renderSemester(sem))}
                        </div>

                    </main>
                    
                    {/* Timer Footer */}
                    <div className="fixed bottom-4 right-4 bg-slate-800 border border-slate-600 px-4 py-2 rounded-full shadow-lg text-xs text-slate-400 flex items-center gap-2">
                         ‚è±Ô∏è Auto-refresh em inatividade
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>